generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  ADMIN
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String?   @unique
  emailVerified DateTime?
  image         String?
  password      String?
  role          Role      @default(USER)

  accounts      Account[]
  sessions      Session[]
  students      Student[]
  simulations   Simulation[]
  analytics     AnalyticsEvent[]
}

model Account {
  id                 String  @id @default(cuid())
  userId             String
  type               String
  provider           String
  providerAccountId  String
  refresh_token      String?
  access_token       String?
  expires_at         Int?
  token_type         String?
  scope              String?
  id_token           String?
  session_state      String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Student {
  id               String   @id @default(uuid())
  name             String
  cgpa             Float
  projects         Int
  internships      Int
  preferredRole    String
  preferredCity    String

  dsa              Int
  algorithms       Int
  systemDesign     Int
  react            Int
  node             Int
  python           Int
  sql              Int
  ml               Int
  dataAnalysis     Int
  embedded         Int

  userId           String?
  user             User?    @relation(fields: [userId], references: [id])

  createdAt        DateTime @default(now())
}

model Simulation {
  id                    String   @id @default(cuid())
  userId                String
  readiness             Int
  competitionIndex      Int
  acceptanceProbability Int
  role                  String
  tier                  String
  createdAt             DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model AnalyticsEvent {
  id        String   @id @default(cuid())
  userId    String?
  eventType String
  metadata  Json?
  createdAt DateTime @default(now())

  user User? @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Internship {
  id              String   @id @default(cuid())
  company         String
  role            String
  category        String
  location        String
  remoteType      String
  stipendMin      Int
  stipendMax      Int
  durationMonths  Int
  skills          String[]
}

model Company {
  id              String   @id @default(uuid())
  name            String
  role            String
  tier            String
  location        String
  seats           Int

  requiredDsa         Int
  requiredReact       Int
  requiredPython      Int
  requiredMl          Int

  competitionIndex    Int

  createdAt       DateTime @default(now())
}

model Offer {
  id               String   @id @default(uuid())
  studentId        String
  stipend          Int
  brandScore       Int
  learningScore    Int
  techStackValue   Int
  networkScore     Int

  createdAt        DateTime @default(now())
}
